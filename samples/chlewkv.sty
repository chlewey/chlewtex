\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{chlewkv}
\RequirePackage{keyval}
\newcommand\chlew@ns{chlew@}
\newcommand\setChlewNS[1]{\def\chlew@ns{#1@}}
%
\let\@@@dfkey\define@key
\def\define@key#1#2{\typeout{Defining key #1:#2}\@@@dfkey{#1}{#2}}
%
\newcommand\chlew@keys[1]{\typeout{Defining valkey namespace `#1'}%
\expandafter\newcommand\csname#1@let\endcsname[2]{\expandafter\let\csname\chlew@ns#1@##1\expandafter\endcsname##2}
\expandafter\newcommand\csname#1@let@\endcsname[2]{\expandafter\let\csname\chlew@ns#1@##1\expandafter\endcsname
	\csname\chlew@ns#1@##2\csname}
\expandafter\newcommand\csname#1@def\endcsname[2]{\expandafter\def\csname\chlew@ns#1@##1\endcsname{##2}}
\expandafter\newcommand\csname#1@def@\endcsname[2]{\expandafter\def\csname\chlew@ns#1@##1\endcsname
	{\csname\chlew@ns#1@##2\endcsname}}
\expandafter\newcommand\csname#1@\endcsname[1]{\csname\chlew@ns#1@##1\endcsname}
\expandafter\newcommand\csname#1@ifempty\endcsname[3]{\expandafter\ifx\csname\chlew@ns#1@##1\endcsname\@empty
	{##2}\else{##1}\fi}
%
\expandafter\newcommand\csname#1@key\endcsname{\expandafter\@ifstar
	\csname#1@key@s\expandafter\endcsname
	\csname#1@key@\endcsname}
\expandafter\newcommand\csname#1@key@s\endcsname[3][\@empty]{%
	\define@key{#1}{##2}[##1]{##3}%
	\expandafter\let\csname\chlew@ns#1@##2\endcsname\@empty}
\expandafter\newcommand\csname#1@key@\endcsname[2][\@empty]{%
	\define@key{#1}{##2}[##1]{\@namedef{\chlew@ns#1@##2}{####1}}%
	\expandafter\let\csname\chlew@ns#1@##2\endcsname\@empty}
\expandafter\newcommand\csname#1@flag\endcsname{\expandafter\@ifstar
	\csname#1@flag@s\expandafter\endcsname
	\csname#1@flag@\endcsname}
\expandafter\newcommand\csname#1@flag@s\endcsname[2]{%
	\define@key{#1}{##1}[true]{##2}%
	\expandafter\let\csname\chlew@ns#1@##1\endcsname\@empty}
\expandafter\newcommand\csname#1@flag@\endcsname[1]{%
	\define@key{#1}{##1}[true]{\@namedef{\chlew@ns#1@##1}{####1}}%
	\expandafter\let\csname\chlew@ns#1@##1\endcsname\@empty}
\expandafter\newcommand\csname#1@alias\endcsname[3][\@empty]{%
	\define@key{#1}{##2}[##1]{\@namedef{\chlew@ns#1@##3}{####1}}}
}
\endinput
